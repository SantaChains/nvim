# 编辑效率工具

<cite>
**本文档引用的文件**  
- [essential.lua](file://lua/plugins/essential.lua)
- [quicker.lua](file://lua/plugins/quicker.lua)
- [blink-cmp.lua](file://lua/plugins/blink-cmp.lua)
</cite>

## 目录
1. [简介](#简介)
2. [核心编辑效率工具](#核心编辑效率工具)
3. [nvim-surround：智能代码环绕](#nvim-surround智能代码环绕)
4. [smart-splits.nvim：智能窗口管理](#smart-splitsnvim智能窗口管理)
5. [treesj：语法树级代码拆分与合并](#treesj语法树级代码拆分与合并)
6. [quicker.lua 中的 's' 键增强](#quickerlua-中的-s-键增强)
7. [blink-cmp：AI 增强补全体验](#blink-cmpai-增强补全体验)
8. [总结](#总结)

## 简介
本文档系统性地介绍并文档化 Neovim 配置中用于提升编辑效率的核心工具。重点分析 `essential.lua` 和 `quicker.lua` 配置文件中集成的多个高效插件，包括 `nvim-surround`、`smart-splits.nvim`、`treesj` 以及 `substitute.nvim`，并介绍 `blink-cmp` 提供的 AI 增强代码补全功能。文档将详细说明每个工具的实现原理、快捷键、使用场景、配置选项，并通过实际案例展示其在日常开发中的价值。

## 核心编辑效率工具
Neovim 的编辑效率提升依赖于一系列精心配置的插件。这些工具覆盖了代码环绕、窗口管理、代码结构调整、文本替换和智能补全等关键环节。通过 `essential.lua` 和 `quicker.lua` 的模块化配置，这些功能被无缝集成，为开发者提供流畅、高效的编码体验。

**Section sources**
- [essential.lua](file://lua/plugins/essential.lua#L1-L30)
- [quicker.lua](file://lua/plugins/quicker.lua#L1-L30)

## nvim-surround：智能代码环绕
`nvim-surround` 插件实现了对代码块的智能环绕与修改。它允许用户快速地为选中的文本添加、删除或更改括号、引号、标签等包围结构。

### 功能与实现
该插件基于 `kylechui/nvim-surround`，在 `essential.lua` 中通过 `require("nvim-surround").setup()` 进行配置。它支持在正常模式和可视模式下操作，例如使用 `ys` 命令环绕一个单词，`ds` 命令删除包围，`cs` 命令更改包围。

### 自定义环绕
配置中展示了如何添加自定义环绕。例如，定义了 `["y"]` 环绕，当用户在可视模式下选择文本并输入 `y` 时，会提示输入一个 URL，然后将选中文本转换为 Markdown 链接格式 `[文本](URL)`。

### 使用场景
- 快速将普通文本转换为字符串、数组元素或函数参数。
- 为 HTML 标签内容添加或修改属性。
- 在 Markdown 中快速创建链接或强调文本。

**Section sources**
- [essential.lua](file://lua/plugins/essential.lua#L2-L20)

## smart-splits.nvim：智能窗口管理
`smart-splits.nvim` 插件提供了直观且智能的窗口分割管理功能，解决了传统窗口操作中光标跳转和调整不便的问题。

### 功能与实现
该插件在 `essential.lua` 中配置，通过 `require('smart-splits').setup()` 进行初始化。它提供了两套独立的快捷键：
- **移动光标**：`<C-h>`, `<C-j>`, `<C-k>`, `<C-l>` 用于在窗口间移动光标。
- **调整大小**：`<A-h>`, `<A-j>`, `<A-k>`, `<A-l>` 用于微调窗口大小，默认每次调整 3 个像素。

### 智能特性
- **边缘行为**：设置 `at_edge = 'wrap'`，当光标到达屏幕边缘时，会自动跳转到相邻的窗口，实现无缝导航。
- **光标跟随**：`cursor_follows_swaps = true` 确保在交换窗口内容后，光标会跟随到目标窗口。
- **忽略特定窗口**：配置 `ignored_filetypes` 和 `ignored_buftypes` 可以防止在文件浏览器（如 NvimTree）等特殊窗口中误操作。

### 使用场景
- 在多窗口布局（如代码、终端、文件树）中快速切换焦点。
- 精细调整窗口大小以获得最佳的屏幕空间利用率。
- 通过 `<leader><C-h/j/k/l>` 交换两个窗口的内容，重新组织工作区。

**Section sources**
- [essential.lua](file://lua/plugins/essential.lua#L133-L169)

## treesj：语法树级代码拆分与合并
`treesj` 插件利用 Neovim 的 Treesitter 引擎，实现了基于语法结构的代码行合并与拆分，比传统的基于字符或单词的操作更加智能和安全。

### 功能与实现
`treesj` 在 `essential.lua` 中配置，依赖于 `nvim-treesitter/nvim-treesitter`。其核心命令是 `<leader>j`，通过 `TSJToggle` 切换当前节点的合并与拆分状态。

### 配置选项
- `use_default_keymaps = false`：禁用默认快捷键，使用自定义映射。
- `max_join_length = 120`：设置合并后行的最大长度，超过则优先拆分。
- `cursor_behavior = 'hold'`：保持光标在操作前的位置。
- `notify = true`：操作成功后显示通知。

### 语言支持
配置中明确启用了对多种语言的支持，包括 Lua、JavaScript、TypeScript 和 JSON。对于每种语言，可以精细控制哪些语法节点（如 `table`, `object`, `array`, `argument_list`）支持合并与拆分，并且 `split` 配置中的 `recursive = true` 允许递归地拆分嵌套结构。

### 使用场景
- 将一个长的函数调用或对象定义从单行拆分为多行，提高可读性。
- 将多个短的、相关的语句合并为一行，使代码更紧凑。
- 在调试时快速展开或折叠数据结构。

**Section sources**
- [essential.lua](file://lua/plugins/essential.lua#L167-L217)

## quicker.lua 中的 's' 键增强
`quicker.lua` 配置文件通过 `gbprod/substitute.nvim` 插件，对原生的 `s` 键进行了功能增强，提供了更强大和直观的文本替换体验。

### 功能与实现
`substitute.nvim` 重载了 `s` 键，使其在正常模式和可视模式下都能工作。其行为比原生 `s` 命令更智能：
- `s`：替换光标下的字符或可视模式下选中的文本。
- `ss`：替换整行。
- `S`：替换从光标位置到行尾的内容。
- `<leader>sr`：使用正则表达式进行替换。

### 增强特性
- `highlight_substituted_text.enabled = true`：替换后会高亮显示被替换的文本，持续 500 毫秒，便于确认操作结果。
- `ai.enabled = true`：集成了 AI 功能（使用 DeepSeek API），可以在替换时提供智能建议。
- `range` 配置允许在可视模式下进行范围替换，且默认使用 `iw`（内部单词）作为动作，使操作更符合直觉。

### 使用场景
- 快速重命名变量或函数，无需进入命令模式。
- 批量修改代码中的特定模式。
- 利用 AI 建议进行更复杂的重构或文本转换。

**Section sources**
- [essential.lua](file://lua/plugins/essential.lua#L218-L270)
- [quicker.lua](file://lua/plugins/quicker.lua#L71-L108)

## blink-cmp：AI 增强补全体验
`blink-cmp` 是一个现代化的补全引擎，它在 `blink-cmp.lua` 配置文件中被集成，旨在提供超越传统 `nvim-cmp` 的智能和美观的补全体验。

### 功能与实现
`blink-cmp` 在 `InsertEnter` 和 `CmdlineEnter` 事件时加载。它通过丰富的配置选项，打造了一个高度可定制的补全界面。

### 关键特性
- **AI 集成**：通过 `sources.providers.avante` 集成了 `blink-cmp-avante` 模块，提供 AI 驱动的补全建议。
- **智能排序**：通过 `score_offset` 为不同来源设置优先级，例如将 `snippets` 的优先级设为最高（100），确保代码片段优先推荐。
- **美观界面**：集成 `colorful-menu.nvim`，自定义菜单的绘制方式，使补全项的图标和标签更加醒目和美观。
- **智能文档**：`documentation.auto_show = true` 使得在选择补全项时，相关文档会立即显示，无需额外按键。

### 快捷键
- `<S-space>`：显示/隐藏补全菜单和文档。
- `<Tab>`：优先选择下一个补全项，其次跳转到下一个代码片段占位符。
- `<S-Tab>`：反向操作。
- `<C-e>` 和 `<C-u>`：在补全列表和代码片段跳转之间切换优先级。

### 使用场景
- 在编写代码时获得更相关、更智能的补全建议，包括整行甚至多行代码的生成。
- 通过内联文档快速了解函数或 API 的用法。
- 在命令行模式下获得智能的命令补全。

**Section sources**
- [blink-cmp.lua](file://lua/plugins/blink-cmp.lua#L1-L145)

## 总结
本文档详细介绍了 Neovim 配置中的一系列核心编辑效率工具。从 `nvim-surround` 的智能环绕，到 `smart-splits.nvim` 的无缝窗口管理，再到 `treesj` 的语法感知代码重构，以及 `substitute.nvim` 对 `s` 键的现代化增强，这些工具共同构建了一个高效、流畅的编辑环境。最后，`blink-cmp` 的引入，将 AI 能力融入补全过程，预示着代码编辑的未来方向。通过合理配置和熟练使用这些工具，开发者可以显著提升编码速度和质量。